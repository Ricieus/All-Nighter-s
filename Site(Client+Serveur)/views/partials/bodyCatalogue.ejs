<style>
    .sectionHaut {
        height: 100vh;
        background-size: cover;
        background-image: url("https://collectingcars.imgix.net/022036/DSC-76322.jpg?fit=clip&w=2000&auto=format,compress&cs=srgb&q=85");
        vertical-align: middle;
        align-items: center;
        align-content: center;
    }

    .boiteMilieu {
        height: 0%;
        background-color: #ffffff;
        width: 50%;
        margin-top: 5%;
        border-radius: 50px;
    }

    .centreColonne {
        position: relative;
        vertical-align: middle;
        align-items: center;
        align-content: center;
    }
</style>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css">
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.10/css/bootstrap-select.min.css">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.10/js/bootstrap-select.min.js"></script>

<div class="container mt-5 pt-5">
    <h1 class="display-5 d-flex justify-content-center">Catalogue</h1>
</div>


<div class="d-flex align-items-center justify-content-center">
    <div class="boiteMilieu">
        <div class="d-flex align-items-center justify-content-center">
            <div class="container">
                <form action="/catalogue/submit_catalogue" method="post">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="centreColonne">
                                <select class="form-control selectpicker" id="marque" style="width: 125%;"
                                    data-live-search="true" title="Veuillez choisir la marque" name="marque">
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="centreColonne">
                                <select selected="true" class="selectpicker form-control" data-live-search="true"
                                    title="Veuillez choisir le modèle" name="modele" id="modele" disabled>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="centreColonne">
                                <select class="selectpicker form-control" title="Veuillez choisir le prix" name="prix"
                                    id="prix" style="width: 125%;" data-live-search="true">
                                    <option value="10000">10 000$</option>
                                    <option value="20000">20 000$</option>
                                    <option value="30000">30 000$</option>
                                    <option value="40000">40 000$</option>
                                    <option value="50000">50 000$</option>
                                    <option value="60000">60 000$</option>
                                    <option value="70000">70 000$</option>
                                    <option value="80000">80 000$</option>
                                    <option value="90000">90 000$</option>
                                    <option value="100000">100 000$</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary" type="submit" style="width: 100%;">Rechercher</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Fonction pour récupérer les données depuis le serveur
        function getData(url, selectId) {
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    data.forEach(function(item) {
                        var option = document.createElement('option');
                        option.value = item;
                        option.textContent = item;
                        document.getElementById(selectId).appendChild(option);
                    });
                    // Rafraîchir le selectpicker une fois les options ajoutées
                    var selectpicker = document.getElementById(selectId);
                    if (selectpicker.classList.contains('selectpicker')) {
                        $(`#${selectId}`).selectpicker('refresh');
                    }
                })
                .catch(error => console.error('Erreur lors de la récupération des données :', error));
        }

        // Charger les marques depuis la base de données
        getData('/get_marques', 'marque');

        // Écouter les changements de sélection de la marque
        document.getElementById('marque').addEventListener('change', function() {
            var marque = this.value;
            if (marque) {
                // Effacer complètement les anciennes options de modèle
                var modeleSelect = document.getElementById('modele');
                modeleSelect.enabled = true;
                modeleSelect.innerHTML = '';

                
                // Charger les modèles de la marque sélectionnée depuis la base de données
                getData(`/get_modeles?marque=${marque}`, 'modele');
            } else {
                var modeleSelect = document.getElementById('modele');
            }
        });
        // Charger les prix depuis la base de données
        getData('/get_prix', 'prix');

        function enableSelect(currentSelectId, prochainSelectID) {
            document.getElementById(currentSelectId).addEventListener('change', function () {
                let currentValue = this.value;
                let prochainSelect = document.getElementById(prochainSelectID);

                prochainSelect.disabled = !currentValue;

                prochainSelect.value = '';

                if (!prochainSelect.disabled) {
                    var previousSelectValue = document.getElementById(currentSelectId).value;
                    getData(`/get_${prochainSelectID}?${currentSelectId}=${previousSelectValue}`, prochainSelectID);
                }
            });
        }
        enableSelect('marque', 'modele');
    });

</script>





<div class="container mt-5">
    <div class="row row-cols-4">
        <% for (let i = 0; i < items.length; i++) { %>
        <div class="col">
            <%- include ('../partials/containerVoiture.ejs', { voiture: items[i] }) %>
        </div>
        <% } %>
    </div>
</div>

