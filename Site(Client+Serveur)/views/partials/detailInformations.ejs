<style>
    .boiteInformation {
        height: 75vh;
        width: 60vh;
    }

    .imgIcons {
        width: 30px;
        height: 30px;
        margin-right: 5%;

        
    }


</style>

<div class="content">
    <div class="d-flex align-items-center justify-content-center mt-5">
        <div class="container">
            <div class="jumbotron p-5">
                <div class="mb-5">
                    <% carDetails.forEach(car => { %>
                        <div class="row">
                            <div class="col">
                                <img class="imgIcons" src="../images/car-silhouette.svg" alt="">
                                <%= car.corps %>
                            </div>
                            <div class="col">
                                <img class="imgIcons" src="../images/odometer.svg" alt="">
                                <%= car.moteur %>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <img class="imgIcons" src="../images/fuel.svg" alt="">
                                <%= car.carburant %>
                            </div>
                            <div class="col">
                                <img class="imgIcons" src="../images/calendar.svg" alt="">
                                <%= car.annee %>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <img class="imgIcons" src="../images/transmission.svg" alt="">
                                <%= car.transmission %>
                            </div>
                            <div class="col">
                                <img class="imgIcons" src="../images/steering-wheel.svg" alt="">
                                <%= car.pneus_bougent %>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <form id="loanCalc" action="" method="get" class="paymentCalc">
                                    <h3>Calculer votre financement par mois</h3>
                                    <div class="col-md-12">
                                        <% if (typeof carDetails !== undefined && typeof carInfo !== undefined) { %>
                                            <% carInfo.forEach(info => { %>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group ">
                                                    <label for="vehiclePrice">Prix du véhicule</label>
                                                    <input type="number" class="form-control" id="vehiclePrice" placeholder="Prix véhicuke">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="downPayment">Acompte</label>
                                                    <input type="number" class="form-control" id="downPayment" placeholder="" value="0">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="tradeValue">Commerce en valeur</label>
                                                    <input type="text" class="form-control" id="tradeValue" placeholder="" value="0">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="intRate">Taux d'intérêt</label>
                                                    <input type="text" class="form-control" id="intRate" placeholder="" value="6.99">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="loanTerm">Durée du financement</label>
                                                    <select class="form-control wider-input" id="loanTerm">
                                                        <option value="36">36 Mois</option>
                                                        <option value="72">48 Mois</option>
                                                        <option value="60">60 Mois</option>
                                                        <option value="72">72 Mois</option>
                                                        <!-- Add more options as needed -->
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mt-2">
                                            <button type="button" class="btn btn-primary calcBtn" onclick="calculatePayments()">Calculer</button>
                                        </div>
        
                                        <div class="row mt-3">
                                            <div class="col-md-12">
                                                <button class="btn btn-primary" onclick="dataPaiement()">Payer</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="col-md-6">
                                <div id="paymentResults"></div>
                            </div>
                        </div>
                    <% }); %>
                <% } %> <!-- Fin du bloc if-else -->
            </div>
        </div>
        
            
        </div>
        
        
        
    </div>
</div>

<script>
    function dataPaiement(){
        const marqueVoiture = document.getElementById('marqueVoiture').innerText || document.getElementById('marqueVoiture').value;
        const tauxInteret = document.getElementById('tauxInteret').innerText || document.getElementById('tauxInteret').value;
        const voiturePrix = document.getElementById('voiturePrix').innerText || document.getElementById('voiturePrix').value;

        // Specify the base URL of the new page
        const baseURL = '/pages/paiement';
        // Create a URLSearchParams object with the query parameters
        const queryParams = new URLSearchParams({
            marque: marqueVoiture,
            taux: tauxInteret,
            price: voiturePrix
        });
        
        // Create the full URL with query parameters
        const newPageURL = `${baseURL}?${queryParams.toString()}`;
        
        // Redirect the user to the new page
        window.location.href = newPageURL;
    }
</script>

<script>
    function calculatePayments(){
        var vehiclePrice = document.getElementById('vehiclePrice').value,
            loanTerm = document.getElementById('loanTerm').value,
            intRate = document.getElementById('intRate').value,
            downPayment = document.getElementById('downPayment').value,
            tradeValue = document.getElementById('tradeValue').value,
            amount = parseInt(vehiclePrice),
            months = parseInt(loanTerm),
            down  = parseInt(downPayment),
            trade =  parseInt(tradeValue),
            totalDown  = down + trade,
            annInterest = parseFloat(intRate),
            monInt = annInterest / 1200;

        if(!amount){
            alert('Please add a loan amount');
            return;
        }

        if(!months){
            months = 60;
            loanTerm = document.getElementById('loanTerm').value = '60';
        }

        if(!downPayment){
            down = 0;
            downPayment = document.getElementById('downPayment').value = '0';
        }

        if(!trade){
            trade = 0;
            tradeValue = document.getElementById('tradeValue').value = '0';
        }

        if(!annInterest){
            annInterest = 3.25;
            intRate = document.getElementById('intRate').value = '3.25';
        }

        var calc = ((monInt + (monInt / (Math.pow((1 + monInt), months) -1))) * (amount - (totalDown || 0))).toFixed(2);

        var paymentResults = document.getElementById('paymentResults');
        paymentResults.style.display = 'block';
        paymentResults.innerHTML = '';
        var results = document.createElement('div');
        results.innerHTML = '<h1 style="text-align:center">Estimated Monthly Payment is:<br/></h1>' + '<h3 style="text-align:center">$' + calc + '/Month</h3>';

        paymentResults.append(results);
    }
</script>
